#include <ostream>
#include <pp_protocol/cc_pa/relay_info.hpp>
using namespace std;

int main(int, char **) {

    std::vector<xCC_PA_RelayServerInfo> TotalList;

    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.1:1001") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.2:1002") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.3:1003") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.4:1004") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.5:1005") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.1:1001") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.2:1002") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.3:1003") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.4:1004") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.5:1005") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.1:1001") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.2:1002") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.3:1003") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.4:1004") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.5:1005") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.1:1001") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.2:1002") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.3:1003") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.4:1004") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.5:1005") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.1:1001") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.2:1002") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.3:1003") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.4:1004") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.5:1005") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.1:1001") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.2:1002") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.3:1003") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.4:1004") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.5:1005") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.1:1001") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.2:1002") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.3:1003") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.4:1004") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.5:1005") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.1:1001") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.2:1002") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.3:1003") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.4:1004") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.5:1005") });

    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.1:1001") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.2:1002") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.3:1003") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.4:1004") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.5:1005") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.1:1001") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.2:1002") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.3:1003") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.4:1004") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.5:1005") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.1:1001") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.2:1002") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.3:1003") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.4:1004") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.5:1005") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.1:1001") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.2:1002") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.3:1003") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.4:1004") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.5:1005") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.1:1001") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.2:1002") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.3:1003") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.4:1004") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.5:1005") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.1:1001") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.2:1002") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.3:1003") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.4:1004") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.5:1005") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.1:1001") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.2:1002") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.3:1003") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.4:1004") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.5:1005") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.1:1001") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.2:1002") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.3:1003") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.4:1004") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.5:1005") });

    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.1:1001") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.2:1002") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.3:1003") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.4:1004") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.5:1005") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.1:1001") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.2:1002") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.3:1003") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.4:1004") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.5:1005") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.1:1001") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.2:1002") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.3:1003") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.4:1004") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.5:1005") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.1:1001") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.2:1002") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.3:1003") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.4:1004") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.5:1005") });

    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.1:7777") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.2:1002") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.3:1003") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.4:1004") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.5:1005") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.1:1001") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.2:1002") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.3:1003") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.4:1004") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.5:1005") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.1:1001") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.2:1002") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.3:1003") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.4:1004") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.5:1005") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.1:1001") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.2:1002") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.3:1003") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.4:1004") });
    TotalList.push_back({ 1, 1024, xNetAddress::Parse("192.168.1.5:1005") });

    cout << ToString(TotalList) << endl;

    auto W = xCC_PA_DownloadRelayServerListRespWriter();

    ubyte B[4000];

    do {
        W.Version         = 888;
        W.StartIndex      = 0;
        W.TotalServerList = &TotalList;
        auto WSize        = W.Serialize(B, sizeof(B));

        auto R     = xCC_PA_DownloadRelayServerListRespReader();
        auto RSize = R.Deserialize(B, WSize);
        cout << RSize << endl;
        cout << R.StartIndex << endl;
        cout << R.Count << endl;
        cout << ToString(R.LocalServerList) << endl;

        auto NextIndex = R.StartIndex + R.Count;
        if (NextIndex < R.Total) {
            W.StartIndex = NextIndex;
            auto WSize   = W.Serialize(B, sizeof(B));

            auto R2    = xCC_PA_DownloadRelayServerListRespReader();
            auto RSize = R2.Deserialize(B, WSize);
            cout << RSize << endl;
            cout << R2.StartIndex << endl;
            cout << R2.Count << endl;
            cout << ToString(R2.LocalServerList) << endl;
        }

    } while (false);

    return 0;
    //
}
